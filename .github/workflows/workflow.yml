# This workflow was automatically generated by tool/generate_workflow.ts
# Please do not edit manually, instead run deno task generate_workflow

name: bench
'on':
  schedule:
    - cron: 0 0 * * *
  push:
    paths:
      - '**.ts'
      - '**.js'
      - '**.tsx'
      - '**.jsx'
      - '**.yml'
      - '**.json'
      - '!frameworks/*/results/*.json'
jobs:
  hello_bench:
    name: 'Hello, bench!'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Install Node
        uses: actions/setup-node@v3
      - name: Install Bun
        uses: antongolub/action-setup-bun@v1.4.0
      - name: Install Bombardier
        run: |-
          wget https://github.com/codesenberg/bombardier/releases/download/v1.2.5/bombardier-linux-amd64 -O bombardier
          chmod +x bombardier
          echo . >> $GITHUB_PATH
      - name: Run Benchmark
        run: deno task benchmark hello_bench
      - name: Save hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: hello_bench-results
  finish:
    name: Finish
    runs-on: ubuntu-latest
    needs:
      - hello_bench
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Load hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: hello_bench-results
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Generate README.md
        run: deno task readme
      - name: Push changes
        if: '${{ github.ref == ''refs/heads/main'' }}'
        uses: actions-js/push@v1
        with:
          github_token: '${{ secrets.GITHUB_TOKEN }}'
          branch: main
